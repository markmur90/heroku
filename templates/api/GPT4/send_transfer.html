{% extends "api/GPT4/base.html" %}
{% load static %}
{% block content %}
  <h2>Enviar Transferencia {{ transfer.payment_id }}</h2>
  
  <form method="post" action="{% url 'send_transfer' payment_id=transfer.payment_id %}">
    {% csrf_token %}
    {{ form.non_field_errors }}
    
    {# – Si no hay token en sesión, solo mostrar botón autorización – #}
    {% if not request.session.access_token %}
      <button type="submit" name="action" value="authorize" class="btn btn-primary">
        Autorizar con Banco
      </button>
      
    {% else %}
      {# – Token presente: Mostrar datos de transferencia – #}
      <div class="mb-3">
        <label for="id_amount">Monto</label>
        {{ form.monto }}
      </div>
      <div class="mb-3">
        <label for="id_destinatario">Destinatario</label>
        {{ form.destinatario }}
      </div>

      {# – Selección de método OTP – #}
      <div class="form-check">
        {{ form.obtain_otp }}
        <label class="form-check-label" for="id_obtain_otp">
          Obtener OTP automáticamente
        </label>
      </div>
      <div class="mb-3">
        <label>Método OTP:</label>
        {{ form.otp_method }}
      </div>

      {# – Campo para OTP manual, ocultable – #}
      <div class="mb-3">
        <label for="id_manual_otp">Introducir OTP manual</label>
        {{ form.manual_otp }}
      </div>

      <button type="submit" name="action" value="send" class="btn btn-success">
        Enviar Transferencia
      </button>
    {% endif %}
  </form>
{% endblock %}
